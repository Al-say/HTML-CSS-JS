name: GitHub Pages Deploy

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
    steps:
      - name: Debug Info
        run: |
          echo "🔍 Workspace: $GITHUB_WORKSPACE"
          echo "📦 Ref: $GITHUB_REF"
          echo "📝 SHA: $GITHUB_SHA"

      - name: Checkout Repository
        run: |
          # 确保工作目录干净
          rm -rf *
          # 克隆仓库
          git clone https://github.com/Al-say/HTML-CSS-JS.git .
          # 检查克隆结果
          ls -la

      - name: Deploy to gh-pages
        run: |
          # 配置git
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # 创建新的gh-pages分支
          git checkout --orphan gh-pages
          git reset --hard
          
          # 添加所有文件
          git add .
          git status
          
          # 提交更改
          git commit -m "Deploy to GitHub Pages"
          
          # 推送到gh-pages分支
          git push -f https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/Al-say/HTML-CSS-JS.git gh-pages
